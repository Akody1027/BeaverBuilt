<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Beaver Built Furniture</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <meta name="theme-color" content="black"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <link rel="apple-touch-icon" href="beaverlogo.png">
  <link rel="icon" href="beaverlogo.ico" type="image/x-icon">
  <link rel="manifest" href="/manifest.json">

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-database-compat.js"></script>

  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; display:flex; flex-direction:column; font-family: Arial, sans-serif; }
    #viewport { flex:1; }
    #viewport iframe { width:100%; height:100%; border:none; }
    #bottom-nav { height:60px; background:rgba(17,17,17,0.9); display:flex; }
    #bottom-nav a { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#fff; text-decoration:none; position:relative; }
    #bottom-nav a.active { background:rgba(255,255,255,0.1); }
    .material-icons { font-size:24px; }
    .badge { position:absolute; top:5px; right:20px; background:#ff3b30; color:#fff; font-size:0.65rem; padding:2px 5px; border-radius:50%; display:none; }
  </style>
</head>
<body>
  <div id="viewport">
    <iframe id="view-frame" src="home.html"></iframe>
  </div>

  <nav id="bottom-nav">
    <a href="#" data-src="home.html" class="nav-btn active">
      <span class="material-icons">home</span><span>Home</span>
    </a>
    <a href="#" data-src="furniture.html" class="nav-btn">
      <span class="material-icons">chair</span><span>Furniture</span>
    </a>
    <a href="#" data-src="decor.html" class="nav-btn">
      <span class="material-icons">wallpaper</span><span>Decor</span>
    </a>
    <a href="#" data-src="chat.html" class="nav-btn">
      <span class="material-icons">chat</span><span>Chat</span>
      <span id="chat-badge" class="badge"></span>
    </a>
    <a href="#" id="cart-btn" data-src="e-commerce.html" class="nav-btn">
      <img src="ecomassets/Cart.png" alt="Cart" style="width:24px;height:24px">
      <span>Cart</span>
      <span id="cart-badge" class="badge"></span>
    </a>
  </nav>

  <script>
    // iframe + nav logic
    const iframe = document.getElementById('view-frame');
    const navButtons = document.querySelectorAll('.nav-btn');
    const cartBtn    = document.getElementById('cart-btn');

    navButtons.forEach(btn => {
      btn.addEventListener('click', async e => {
        e.preventDefault();
        // clear active
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const src = btn.dataset.src;
        const currentSrc = iframe.src.split('/').pop();

        if (src === 'e-commerce.html' && currentSrc === src) {
          // already on cart page â†’ just toggle popover
          iframe.contentWindow.postMessage('toggleCart', '*');
        } else {
          // load the page, then toggle
          iframe.src = src;
          if (src === 'e-commerce.html') {
            // once loaded, send toggle
            iframe.onload = () => iframe.contentWindow.postMessage('toggleCart', '*');
          }
        }
      });
    });

    // Cart badge from localStorage
    function updateCartBadge() {
      const cart = JSON.parse(localStorage.getItem('bbf_cart') || '[]');
      const total = cart.reduce((s,i)=>s+i.qty,0);
      const cb = document.getElementById('cart-badge');
      if (total>0) { cb.textContent=total; cb.style.display='block'; }
      else cb.style.display='none';
    }
    updateCartBadge();
    window.addEventListener('storage', updateCartBadge);

    // Live chat badge (same as before)...
    const firebaseConfig = { /* your config */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatBadge = document.getElementById('chat-badge');
    const visitorUid  = localStorage.getItem('visitorUid');
    const visitorName = localStorage.getItem('visitorName');
    if (visitorUid && visitorName) {
      let init=true;
      const ref = db.ref('threads/'+visitorUid);
      ref.once('value',()=>init=false);
      ref.on('child_added',snap=>{
        const m = snap.val();
        if (init||m.system||m.sender===visitorName) return;
        const n = parseInt(chatBadge.textContent||'0')+1;
        chatBadge.textContent = n; chatBadge.style.display='block';
      });
    }
  </script>
</body>
</html>
