<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ... all your previous styles ... */
    /* Add yellow highlight for pending payment section */
    #pending-section {
      background: #fef9c3;
      border: 2px solid #fde047;
      border-radius: 12px;
      padding: 1rem 1.3rem;
      margin-bottom: 1.7rem;
      font-size: 1rem;
    }
    .pending-title {
      color: #b45309;
      font-weight: bold;
      font-size: 1.15rem;
      margin-bottom: 0.8rem;
    }
    .pending-item {
      border-bottom: 1px solid #fde047;
      padding-bottom: 0.6rem;
      margin-bottom: 0.5rem;
    }
    .pending-item:last-child { border-bottom: none; }
    .pending-action-btn {
      margin-right: 12px;
      margin-top: 0.3rem;
      padding: 0.3rem 1.1rem;
      border-radius: 6px;
      font-weight: 600;
      font-size: 1rem;
      transition: background 0.12s;
    }
    .pending-approve { background: #bbf7d0; color: #166534; border: 1px solid #16a34a;}
    .pending-deny { background: #fee2e2; color: #b91c1c; border: 1px solid #f87171;}
    .pending-count { font-size: 0.96em; margin-left: 6px; color: #b45309;}
  </style>
</head>
<body class="flex h-screen bg-gray-50">
  <!-- (No changes to previous modals, sidebar, header, etc.) -->

  <!-- Sidebar -->
  <nav id="sidebar" class="hidden flex-shrink-0 flex-col bg-white p-4 shadow-lg">
    <h1 class="mb-4 text-2xl font-bold">Admin</h1>
    <button data-target="dashboard" class="nav-link mb-2 flex w-full items-center rounded px-2 py-1 text-left text-gray-700 hover:bg-gray-100">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9.75L12 4.5l9 5.25V21a.75.75 0 01-.75.75H3.75A.75.75 0 013 21V9.75z"/></svg>Dashboard
    </button>
    <div class="sidebar-divider"></div>
    <div class="mb-2 flex items-center">
      <span class="text-gray-700">ðŸ‘¥ Customers</span>
      <button id="add-cust-icon" class="ml-2 rounded bg-gray-200 px-2 py-1">+</button>
    </div>
    <ul id="sidebar-customer-list" class="space-y-1 text-gray-600"></ul>
  </nav>

  <!-- Main Content -->
  <div id="main" class="hidden flex flex-1 flex-col">
    <header class="bg-white shadow-md">
      <div class="px-4 py-3"><h2 id="page-title" class="text-xl font-semibold">Dashboard</h2></div>
    </header>
    <main class="mx-auto flex-1 max-w-4xl overflow-auto p-6 space-y-6 w-full">
      <!-- Dashboard -->
      <section id="dashboard" class="space-y-6">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
          <!-- ... dashboard summary cards ... -->
        </div>
        <div class="rounded-2xl bg-white p-6 shadow">
          <h3 class="mb-4 text-lg font-semibold">Invoice Tracking Calendar</h3>
          <div id="invoice-grid"></div>
          <!-- Pending Payment Confirmation Section (ADDED) -->
          <div id="pending-section"></div>
          <div id="batch-bar">
            <div class="bar-actions w-full flex flex-row gap-4 justify-center">
              <!-- ... existing batch buttons ... -->
            </div>
            <div class="mt-2"><span id="batch-count">0</span> selected.</div>
          </div>
        </div>
      </section>
      <!-- ... (rest of your HTML unchanged) ... -->
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- (all your existing code) ---

      // --- Pending Payments Section ---
      function getPendingPayments() {
        try { return JSON.parse(localStorage.getItem('pendingPayments') || '[]'); }
        catch (e) { return []; }
      }
      function savePendingPayments(list) {
        try { localStorage.setItem('pendingPayments', JSON.stringify(list)); }
        catch (e) {}
      }
      function renderPendingSection() {
        const div = document.getElementById('pending-section');
        const pending = getPendingPayments();
        if (!div) return;
        if (!pending.length) {
          div.innerHTML = '<div class="pending-title">Pending Payment Confirmation</div><div>0 pending payments</div>';
          return;
        }
        let html = `<div class="pending-title">Pending Payment Confirmation <span class="pending-count">(${pending.length})</span></div>`;
        pending.forEach((p, i) => {
          html += `<div class="pending-item">
            <div>
              <strong>${p.customerName}</strong> submitted a manual payment.<br>
              <span>Invoice: $${p.amount} (${p.invoiceId||''})</span><br>
              <span>Payment method: <b>${p.method||'Unknown'}</b></span>
            </div>
            <div class="flex gap-3 mt-2">
              <button class="pending-action-btn pending-approve" onclick="approvePendingPayment(${i})">Approve</button>
              <button class="pending-action-btn pending-deny" onclick="denyPendingPayment(${i})">Deny</button>
            </div>
          </div>`;
        });
        div.innerHTML = html;
      }

      // Attach globally for button handlers
      window.approvePendingPayment = function(idx) {
        let pending = getPendingPayments();
        const approved = pending.splice(idx, 1)[0];
        // Mark the invoice as paid (find by invoiceId, customerId, amount)
        let bills = getBills();
        const billIdx = bills.findIndex(b =>
          b.customerId === approved.customerId &&
          (!approved.invoiceId || b.createdAt === approved.invoiceId) &&
          Number(b.amount) === Number(approved.amount)
        );
        if (billIdx !== -1) {
          bills[billIdx].paid = true;
          saveBills(bills);
        }
        savePendingPayments(pending);
        renderPendingSection();
        updateMetrics && updateMetrics();
        updateGrid && updateGrid();
      };
      window.denyPendingPayment = function(idx) {
        let pending = getPendingPayments();
        pending.splice(idx, 1);
        savePendingPayments(pending);
        renderPendingSection();
      };

      // Render this section after grid
      window.renderPendingSection = renderPendingSection;

      // ---- Call on Login + Calendar Update
      function loginInit() {
        // ... previous sidebar, metrics, grid ...
        populateSidebar();
        updateMetrics();
        updateGrid();
        renderPendingSection();
        document.querySelector('.nav-link[data-target="dashboard"]').classList.add('active');
        showSection('dashboard');
      }
      // Replace loginBtn listener with:
      loginBtn.addEventListener('click', function(){
        pinError.textContent = '';
        if(pinInput.value==='1234'){
          loginBtnText.classList.add('hidden');
          loginBtnSpinner.classList.remove('hidden');
          loginBtn.disabled = true;
          setTimeout(function(){
            loginOverlay.style.display='none';
            sidebar.style.display='flex';
            main.style.display='flex';
            loginInit();
            loginBtnText.classList.remove('hidden');
            loginBtnSpinner.classList.add('hidden');
            loginBtn.disabled = false;
            pinInput.value = '';
          }, 2000);
        } else {
          pinError.textContent = 'Invalid PIN';
        }
      });

      // When calendar grid or bills change, also update pending section:
      const origUpdateGrid = updateGrid;
      updateGrid = function() {
        origUpdateGrid();
        renderPendingSection();
      };

      // (all other script unchanged...)
    });
  </script>
</body>
</html>
