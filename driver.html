<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Driver Navigation</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet"/>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: 'Roboto', sans-serif;
      background: #f4f4f9; transition: opacity 0.5s ease;
    }
    /* Initial name screen */
    #initial-container {
      position: absolute; top:50%; left:50%;
      transform: translate(-50%,-50%);
      background: #fff; padding:2rem; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      display:flex; flex-direction:column; gap:1rem; align-items:center;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    /* Status bar */
    #status-bar {
      position:fixed; top:1rem; left:1rem;
      display:none; align-items:center; gap:0.5rem;
      font-weight:500; color:#333;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .status-dot {
      width:12px; height:12px; border-radius:50%; background:#4caf50;
    }
    /* Address + buttons */
    #navigation-container {
      position:fixed; top:4rem; left:50%; transform:translateX(-50%);
      display:none; align-items:center; gap:1rem;
      background:rgba(255,255,255,0.9); padding:0.5rem 1rem;
      border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    input, button {
      font-size:1rem; padding:0.5rem 1rem; border-radius:8px;
    }
    input {
      border:1px solid #ccc; width:16rem;
    }
    button {
      border:none; background:#4caf50; color:#fff; cursor:pointer;
      transition: background 0.2s;
    }
    button:disabled {
      background:#ccc; cursor:not-allowed;
    }
    button:hover:not(:disabled) {
      background:#43a047;
    }
  </style>
</head>
<body>
  <!-- 1) Enter driver name -->
  <div id="initial-container">
    <input id="driverNameInput" type="text" placeholder="Enter driver name"/>
    <button id="activateBtn">Activate</button>
  </div>

  <!-- 2) Status bar -->
  <div id="status-bar">
    <span class="status-dot"></span>
    <span id="statusDriverName"></span>
  </div>

  <!-- 3) Destination + actions -->
  <div id="navigation-container">
    <input id="addressInput" type="text" placeholder="Enter destination"/>
    <button id="navigateBtn">Navigate</button>
    <button id="confirmBtn" style="display:none;">Confirm Delivery</button>
  </div>

  <script>
    let geocoder, currentPosition;

    function initMap() {
      geocoder = new google.maps.Geocoder();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => { currentPosition = { lat: pos.coords.latitude, lng: pos.coords.longitude }; },
          () => console.warn('Geolocation unavailable')
        );
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const initial     = document.getElementById('initial-container');
      const driverInput = document.getElementById('driverNameInput');
      const activate    = document.getElementById('activateBtn');
      const statusBar   = document.getElementById('status-bar');
      const nameLabel   = document.getElementById('statusDriverName');
      const navCont     = document.getElementById('navigation-container');
      const addrInput   = document.getElementById('addressInput');
      const navBtn      = document.getElementById('navigateBtn');
      const confirmBtn  = document.getElementById('confirmBtn');

      activate.addEventListener('click', () => {
        const name = driverInput.value.trim();
        if (!name) return alert('Please enter a driver name.');
        // animate out initial screen
        initial.style.opacity = '0';
        initial.style.transform = 'translate(-50%,-60%)';
        setTimeout(() => {
          initial.style.display = 'none';
          nameLabel.textContent = `Driver: ${name}`;
          statusBar.style.display = 'flex';
          navCont.style.display  = 'flex';
        }, 500);
      });

      navBtn.addEventListener('click', () => {
        const destAddr = addrInput.value.trim();
        if (!destAddr) return alert('Please enter a destination.');

        geocoder.geocode({ address: destAddr }, (results, status) => {
          if (status === 'OK') {
            const dest = results[0].geometry.location;
            const origin = currentPosition
              ? `${currentPosition.lat},${currentPosition.lng}`
              : '';
            const mapsUrl =
              `https://www.google.com/maps/dir/?api=1` +
              `&origin=${origin}` +
              `&destination=${dest.lat()},${dest.lng()}` +
              `&travelmode=driving`;

            // fade out current page
            document.body.style.opacity = '0';
            setTimeout(() => {
              const w = screen.availWidth, h = screen.availHeight;
              window.open(
                mapsUrl,
                '_blank',
                `toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,left=0,top=0,width=${w},height=${h}`
              );
              // restore behind-the-scenes so page isn't stuck transparent
              document.body.style.opacity = '1';
            }, 500);

            // swap to Confirm Delivery
            navBtn.style.display     = 'none';
            confirmBtn.style.display = 'inline-block';
            addrInput.disabled       = true;
          } else {
            alert('Geocode error: ' + status);
          }
        });
      });

      confirmBtn.addEventListener('click', () => {
        // reset all
        navCont.style.opacity    = '0';
        statusBar.style.opacity  = '0';
        setTimeout(() => {
          statusBar.style.display = 'none';
          navCont.style.display   = 'none';
          initial.style.display   = 'flex';
          initial.style.opacity   = '1';
          initial.style.transform = 'translate(-50%,-50%)';
          driverInput.value       = '';
          addrInput.value         = '';
          addrInput.disabled      = false;
          navBtn.style.display    = 'inline-block';
          confirmBtn.style.display= 'none';
        }, 500);
      });
    });
  </script>

  <script defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYk1zuUkelnUHH5u_w4NGSnUYKBzQpQFQ&callback=initMap">
  </script>
</body>
</html>
