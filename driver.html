<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Driver Navigation</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet"/>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: 'Roboto', sans-serif;
      background: #f4f4f9;
    }
    /* 1) Initial “enter name” screen */
    #initial-container {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff; padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex; flex-direction: column; gap: 1rem; align-items: center;
    }
    #initial-container input {
      padding: 0.75rem 1rem; font-size: 1rem;
      border: 1px solid #ccc; border-radius: 8px; width: 16rem;
    }
    #initial-container button {
      padding: 0.75rem 1.5rem; font-size: 1rem;
      border: none; border-radius: 8px;
      background: #4caf50; color: #fff; cursor: pointer;
      transition: background 0.2s;
    }
    #initial-container button:hover {
      background: #43a047;
    }

    /* 2) Status bar (hidden until activated) */
    #status-bar {
      position: fixed; top: 1rem; left: 1rem;
      display: none; align-items: center; gap: 0.5rem;
      font-weight: 500; color: #333;
    }
    .status-dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: #4caf50;
    }

    /* 3) Address + Navigate / Confirm container */
    #navigation-container {
      position: fixed; top: 4rem; left: 50%; transform: translateX(-50%);
      display: none; align-items: center; gap: 1rem;
      background: rgba(255,255,255,0.9); padding: 0.5rem 1rem;
      border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 9;
    }
    #navigation-container input {
      padding: 0.5rem 1rem; font-size: 1rem;
      border: 1px solid #ccc; border-radius: 8px; width: 16rem;
    }
    #navigation-container button {
      padding: 0.5rem 1.25rem; font-size: 1rem;
      border: none; border-radius: 8px;
      background: #4caf50; color: #fff; cursor: pointer;
      transition: background 0.2s;
    }
    #navigation-container button:disabled {
      background: #ccc; cursor: not-allowed;
    }
    #navigation-container button:hover:not(:disabled) {
      background: #43a047;
    }

    /* 4) Map iframe */
    #map-container {
      display: none;
      position: absolute; top: 8rem; left: 0; right: 0; bottom: 20%;
      border-top-left-radius: 16px; border-top-right-radius: 16px;
      overflow: hidden; box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }
    #map-frame {
      width: 100%; height: 100%; border: none;
    }
  </style>
</head>
<body>

  <!-- 1) Initial “enter name” screen -->
  <div id="initial-container">
    <input id="driverNameInput" type="text" placeholder="Enter driver name"/>
    <button id="activateBtn">Activate</button>
  </div>

  <!-- 2) Status bar -->
  <div id="status-bar">
    <span class="status-dot"></span>
    <span id="statusDriverName"></span>
  </div>

  <!-- 3) Address + Navigate / Confirm -->
  <div id="navigation-container">
    <input id="addressInput" type="text" placeholder="Enter destination"/>
    <button id="navigateBtn">Navigate</button>
    <button id="confirmBtn" style="display:none;">Confirm Delivery</button>
  </div>

  <!-- 4) Embedded Google Navigate -->
  <div id="map-container">
    <iframe 
      id="map-frame"
      src=""
      allowfullscreen>
    </iframe>
  </div>

  <script>
    let geocoder, currentPosition;

    // Initialize only geocoder + geolocation
    function initMap() {
      geocoder = new google.maps.Geocoder();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => {
            currentPosition = {
              lat: pos.coords.latitude,
              lng: pos.coords.longitude
            };
          },
          () => console.warn('Geolocation failed or denied.')
        );
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const initialContainer    = document.getElementById('initial-container');
      const driverNameInput     = document.getElementById('driverNameInput');
      const activateBtn         = document.getElementById('activateBtn');
      const statusBar           = document.getElementById('status-bar');
      const statusDriverName    = document.getElementById('statusDriverName');
      const navigationContainer = document.getElementById('navigation-container');
      const addressInput        = document.getElementById('addressInput');
      const navigateBtn         = document.getElementById('navigateBtn');
      const confirmBtn          = document.getElementById('confirmBtn');
      const mapContainer        = document.getElementById('map-container');
      const mapFrame            = document.getElementById('map-frame');

      // Activate driver
      activateBtn.addEventListener('click', () => {
        const name = driverNameInput.value.trim();
        if (!name) return alert('Please enter a driver name.');
        initialContainer.style.display      = 'none';
        statusDriverName.textContent        = `Driver: ${name}`;
        statusBar.style.display             = 'flex';
        navigationContainer.style.display   = 'flex';
      });

      // Navigate: embed Google Maps navigation
      navigateBtn.addEventListener('click', () => {
        const addr = addressInput.value.trim();
        if (!addr) return alert('Please enter a destination.');

        geocoder.geocode({ address: addr }, (results, status) => {
          if (status === 'OK') {
            const dest = results[0].geometry.location;
            const origin = currentPosition
              ? `${currentPosition.lat},${currentPosition.lng}`
              : '';

            // Build the embed URL for navigation
            const embedUrl = 
              `https://www.google.com/maps/embed/v1/directions` +
              `?key=YOUR_API_KEY` +
              `&origin=${origin}` +
              `&destination=${dest.lat()},${dest.lng()}` +
              `&mode=driving&dir_action=navigate`;

            mapFrame.src = embedUrl;
            mapContainer.style.display = 'block';

            // Swap buttons
            navigateBtn.style.display = 'none';
            confirmBtn.style.display  = 'inline-block';
            addressInput.disabled     = true;
          } else {
            alert('Geocode error: ' + status);
          }
        });
      });

      // Confirm delivery: reset to start
      confirmBtn.addEventListener('click', () => {
        // Hide everything
        mapContainer.style.display        = 'none';
        statusBar.style.display           = 'none';
        navigationContainer.style.display = 'none';
        initialContainer.style.display    = 'flex';

        // Reset inputs/buttons
        driverNameInput.value = '';
        addressInput.value    = '';
        addressInput.disabled = false;
        navigateBtn.style.display = 'inline-block';
        confirmBtn.style.display  = 'none';
      });
    });
  </script>

  <!-- Load Google Maps Geocoder -->
  <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYk1zuUkelnUHH5u_w4NGSnUYKBzQpQFQ&callback=initMap&libraries=places"></script>
</body>
</html>
